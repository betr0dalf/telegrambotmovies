<!DOCTYPE html>

<html lang="ru" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>telegram_bot.main &#8212; –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è MovieBot 1.0</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=27fed22d" />
    <script src="../../_static/jquery.js?v=5d32c60e"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script src="../../_static/documentation_options.js?v=9ca2116e"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/translations.js?v=cd1d70c9"></script>
    <link rel="index" title="–ê–ª—Ñ–∞–≤–∏—Ç–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å" href="../../genindex.html" />
    <link rel="search" title="–ü–æ–∏—Å–∫" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>–ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ telegram_bot.main</h1><div class="highlight"><pre>
<span></span><span class="ch">#!/usr/bin/env python</span>
<span class="c1"># -*- coding: utf-8 -*-</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">–û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å Telegram-–±–æ—Ç–∞ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ñ–∏–ª—å–º–æ–≤ –∏ —Å–µ—Ä–∏–∞–ª–æ–≤.</span>

<span class="sd">–ë–æ—Ç –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏:</span>
<span class="sd">- –ü–æ–∏—Å–∫ —Ñ–∏–ª—å–º–æ–≤ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é</span>
<span class="sd">- –¢–æ–ø —Ñ–∏–ª—å–º–æ–≤ –ø–æ –∂–∞–Ω—Ä—É</span>
<span class="sd">- –¢–æ–ø —Ñ–∏–ª—å–º–æ–≤ –∑–∞ –≥–æ–¥</span>
<span class="sd">- –¢–æ–ø —Ñ–∏–ª—å–º–æ–≤ —Ä–µ–∂–∏—Å—Å–µ—Ä–∞</span>
<span class="sd">- –¢–æ–ø —Ñ–∏–ª—å–º–æ–≤ –∞–∫—Ç–µ—Ä–∞</span>
<span class="sd">- –ü–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∏–ª—å–º–µ</span>

<span class="sd">–î–ª—è —Ä–∞–±–æ—Ç—ã —Ç—Ä–µ–±—É–µ—Ç—Å—è:</span>
<span class="sd">- API-—Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞</span>
<span class="sd">- –§–∞–π–ª —Å –¥–∞–Ω–Ω—ã–º–∏ –æ —Ñ–∏–ª—å–º–∞—Ö (MovieData.csv)</span>
<span class="sd">- –ú–æ–¥—É–ª—å background –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">telebot</span>
<span class="kn">from</span> <span class="nn">telebot</span> <span class="kn">import</span> <span class="n">types</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="c1">#from background import keep_alive</span>
<span class="kn">from</span> <span class="nn">telegram_bot.background</span> <span class="kn">import</span> <span class="n">keep_alive</span>

<div class="viewcode-block" id="MovieBot">
<a class="viewcode-back" href="../../telegram_bot.html#telegram_bot.main.MovieBot">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">class</span> <span class="nc">MovieBot</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –ö–ª–∞—Å—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è Telegram-–±–æ—Ç–æ–º –ø–æ–∏—Å–∫–∞ —Ñ–∏–ª—å–º–æ–≤.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        bot (telebot.TeleBot): –≠–∫–∑–µ–º–ø–ª—è—Ä Telegram –±–æ—Ç–∞</span>
<span class="sd">        movies (pd.DataFrame): –î–∞–Ω–Ω—ã–µ –æ —Ñ–∏–ª—å–º–∞—Ö</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MovieBot.__init__">
<a class="viewcode-back" href="../../telegram_bot.html#telegram_bot.main.MovieBot.__init__">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;MovieData.csv&#39;</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞.</span>

<span class="sd">        :param token: API-—Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞</span>
<span class="sd">        :type token: str</span>
<span class="sd">        :param data_file: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å –¥–∞–Ω–Ω—ã–º–∏ –æ —Ñ–∏–ª—å–º–∞—Ö</span>
<span class="sd">        :type data_file: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bot</span> <span class="o">=</span> <span class="n">telebot</span><span class="o">.</span><span class="n">TeleBot</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_movie_data</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_handlers</span><span class="p">()</span></div>


<div class="viewcode-block" id="MovieBot.load_movie_data">
<a class="viewcode-back" href="../../telegram_bot.html#telegram_bot.main.MovieBot.load_movie_data">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
    <span class="k">def</span> <span class="nf">load_movie_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –æ —Ñ–∏–ª—å–º–∞—Ö.</span>

<span class="sd">        :param data_file: –ü—É—Ç—å –∫ CSV —Ñ–∞–π–ª—É —Å –¥–∞–Ω–Ω—ã–º–∏</span>
<span class="sd">        :type data_file: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">movies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>
        <span class="c1"># –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="p">[</span><span class="s1">&#39;ratingKP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="p">[</span><span class="s1">&#39;ratingKP&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="p">[</span><span class="s1">&#39;ratingImdb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="p">[</span><span class="s1">&#39;ratingImdb&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span></div>


<div class="viewcode-block" id="MovieBot.setup_handlers">
<a class="viewcode-back" href="../../telegram_bot.html#telegram_bot.main.MovieBot.setup_handlers">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
    <span class="k">def</span> <span class="nf">setup_handlers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞.&quot;&quot;&quot;</span>

        <span class="nd">@self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">message_handler</span><span class="p">(</span><span class="n">commands</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;start&#39;</span><span class="p">])</span>
        <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_main_menu</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="nd">@self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">message_handler</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">message</span><span class="p">:</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">handle_all_messages</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_click</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="nd">@self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">callback_query_handler</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">call</span><span class="p">:</span> <span class="n">call</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;movie_&#39;</span><span class="p">))</span>
        <span class="k">def</span> <span class="nf">callback_movie_details</span><span class="p">(</span><span class="n">call</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">handle_movie_callback</span><span class="p">(</span><span class="n">call</span><span class="p">)</span></div>


<div class="viewcode-block" id="MovieBot.show_main_menu">
<a class="viewcode-back" href="../../telegram_bot.html#telegram_bot.main.MovieBot.show_main_menu">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
    <span class="k">def</span> <span class="nf">show_main_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –±–æ—Ç–∞.</span>

<span class="sd">        :param message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è Telegram</span>
<span class="sd">        :type message: telebot.types.Message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">markup</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ReplyKeyboardMarkup</span><span class="p">(</span><span class="n">resize_keyboard</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">button1</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">KeyboardButton</span><span class="p">(</span><span class="s1">&#39;–ò—Å–∫–∞—Ç—å —Ñ–∏–ª—å–º üçø&#39;</span><span class="p">)</span>
        <span class="n">button2</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">KeyboardButton</span><span class="p">(</span><span class="s1">&#39;–¢–æ–ø —Ñ–∏–ª—å–º–æ–≤ –ø–æ –∂–∞–Ω—Ä—É üé•&#39;</span><span class="p">)</span>
        <span class="n">button3</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">KeyboardButton</span><span class="p">(</span><span class="s1">&#39;–¢–æ–ø —Ñ–∏–ª—å–º—ã –∑–∞ –≥–æ–¥ üî•&#39;</span><span class="p">)</span>
        <span class="n">button4</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">KeyboardButton</span><span class="p">(</span><span class="s1">&#39;–¢–æ–ø —Ñ–∏–ª—å–º—ã —Ä–µ–∂–∏—Å—Å–µ—Ä–∞ üé¨&#39;</span><span class="p">)</span>
        <span class="n">button5</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">KeyboardButton</span><span class="p">(</span><span class="s1">&#39;–¢–æ–ø —Ñ–∏–ª—å–º—ã –∞–∫—Ç—ë—Ä–∞ üåü&#39;</span><span class="p">)</span>
        <span class="n">markup</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">button1</span><span class="p">)</span>
        <span class="n">markup</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">button2</span><span class="p">,</span> <span class="n">button3</span><span class="p">)</span>
        <span class="n">markup</span><span class="o">.</span><span class="n">row</span><span class="p">(</span><span class="n">button4</span><span class="p">,</span> <span class="n">button5</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                              <span class="s1">&#39;–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:&#39;</span><span class="p">,</span>
                              <span class="n">reply_markup</span><span class="o">=</span><span class="n">markup</span><span class="p">)</span></div>


<div class="viewcode-block" id="MovieBot.on_click">
<a class="viewcode-back" href="../../telegram_bot.html#telegram_bot.main.MovieBot.on_click">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
    <span class="k">def</span> <span class="nf">on_click</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –¥–µ–π—Å—Ç–≤–∏—è –∏–∑ –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é.</span>

<span class="sd">        :param message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è Telegram</span>
<span class="sd">        :type message: telebot.types.Message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;–ò—Å–∫–∞—Ç—å —Ñ–∏–ª—å–º üçø&#39;</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞:&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">register_next_step_handler</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_movie</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;–¢–æ–ø —Ñ–∏–ª—å–º–æ–≤ –ø–æ –∂–∞–Ω—Ä—É üé•&#39;</span><span class="p">:</span>
                <span class="n">genres</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="p">[</span><span class="s1">&#39;Genres&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">eval</span><span class="p">)</span><span class="o">.</span><span class="n">explode</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span>
                <span class="n">markup</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">ReplyKeyboardMarkup</span><span class="p">(</span><span class="n">resize_keyboard</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">genre</span> <span class="ow">in</span> <span class="n">genres</span><span class="p">:</span>
                    <span class="n">markup</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">KeyboardButton</span><span class="p">(</span><span class="n">genre</span><span class="p">))</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                            <span class="s1">&#39;–í—ã–±–µ—Ä–∏—Ç–µ –∂–∞–Ω—Ä:&#39;</span><span class="p">,</span>
                                            <span class="n">reply_markup</span><span class="o">=</span><span class="n">markup</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">register_next_step_handler</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">select_genre</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;–¢–æ–ø —Ñ–∏–ª—å–º—ã –∑–∞ –≥–æ–¥ üî•&#39;</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                            <span class="s1">&#39;–í–≤–µ–¥–∏—Ç–µ –≥–æ–¥ –≤—ã—Ö–æ–¥–∞ —Ñ–∏–ª—å–º–æ–≤:&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">register_next_step_handler</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_year</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;–¢–æ–ø —Ñ–∏–ª—å–º—ã —Ä–µ–∂–∏—Å—Å–µ—Ä–∞ üé¨&#39;</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;–í–≤–µ–¥–∏—Ç–µ –∏–º—è —Ä–µ–∂–∏—Å—Å—ë—Ä–∞:&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">register_next_step_handler</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_director</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">message</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="s1">&#39;–¢–æ–ø —Ñ–∏–ª—å–º—ã –∞–∫—Ç—ë—Ä–∞ üåü&#39;</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s1">&#39;–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∞–∫—Ç—ë—Ä–∞:&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">register_next_step_handler</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_actor</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                      <span class="s1">&#39;–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –ª—é–±—É—é –∏–∑ –∫–Ω–æ–ø–æ–∫ –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞ üëÅÔ∏èüëÑüëÅÔ∏è&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_main_menu</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_main_menu</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


    <span class="c1"># –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã —Å –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π...</span>
    <span class="c1"># –ü—Ä–∏–≤–æ–∂—É –∏—Ö –≤ —Å–æ–∫—Ä–∞—â–µ–Ω–Ω–æ–º –≤–∏–¥–µ, –Ω–æ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—ã</span>

<div class="viewcode-block" id="MovieBot.get_year">
<a class="viewcode-back" href="../../telegram_bot.html#telegram_bot.main.MovieBot.get_year">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
    <span class="k">def</span> <span class="nf">get_year</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–≤–æ–¥ –≥–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ø —Ñ–∏–ª—å–º–æ–≤ –∑–∞ —ç—Ç–æ—Ç –≥–æ–¥.</span>

<span class="sd">        :param message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å –≤–≤–µ–¥–µ–Ω–Ω—ã–º –≥–æ–¥–æ–º</span>
<span class="sd">        :type message: telebot.types.Message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">year</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top_movies_by_year</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">year</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                  <span class="s1">&#39;–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –≥–æ–¥ (–Ω–∞–ø—Ä–∏–º–µ—Ä: 2020).&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_main_menu</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="MovieBot.get_director">
<a class="viewcode-back" href="../../telegram_bot.html#telegram_bot.main.MovieBot.get_director">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
    <span class="k">def</span> <span class="nf">get_director</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–≤–æ–¥ –∏–º–µ–Ω–∏ —Ä–µ–∂–∏—Å—Å–µ—Ä–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ø –µ–≥–æ —Ñ–∏–ª—å–º–æ–≤.</span>

<span class="sd">        :param message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏–º–µ–Ω–µ–º —Ä–µ–∂–∏—Å—Å–µ—Ä–∞</span>
<span class="sd">        :type message: telebot.types.Message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">director</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">text</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">director</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                  <span class="s1">&#39;–ò–º—è —Ä–µ–∂–∏—Å—Å–µ—Ä–∞ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_main_menu</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top_movies_by_director</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">director</span><span class="p">)</span></div>


<div class="viewcode-block" id="MovieBot.get_actor">
<a class="viewcode-back" href="../../telegram_bot.html#telegram_bot.main.MovieBot.get_actor">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
    <span class="k">def</span> <span class="nf">get_actor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤–≤–æ–¥ –∏–º–µ–Ω–∏ –∞–∫—Ç–µ—Ä–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ø —Ñ–∏–ª—å–º–æ–≤ —Å –µ–≥–æ —É—á–∞—Å—Ç–∏–µ–º.</span>

<span class="sd">        :param message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∏–º–µ–Ω–µ–º –∞–∫—Ç–µ—Ä–∞</span>
<span class="sd">        :type message: telebot.types.Message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">actor</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">text</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">actor</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                  <span class="s1">&#39;–ò–º—è –∞–∫—Ç–µ—Ä–∞ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_main_menu</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top_movies_by_actor</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">actor</span><span class="p">)</span></div>


<div class="viewcode-block" id="MovieBot.search_movie">
<a class="viewcode-back" href="../../telegram_bot.html#telegram_bot.main.MovieBot.search_movie">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
    <span class="k">def</span> <span class="nf">search_movie</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–∏—Å–∫ —Ñ–∏–ª—å–º–∞ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é.</span>

<span class="sd">        :param message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å –Ω–∞–∑–≤–∞–Ω–∏–µ–º —Ñ–∏–ª—å–º–∞</span>
<span class="sd">        :type message: telebot.types.Message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">movie_name</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">movie_name</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                  <span class="s1">&#39;–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –º–∏–Ω–∏–º—É–º 2 —Å–∏–º–≤–æ–ª–∞.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_main_menu</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">found_movies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="p">[</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="p">[</span><span class="s1">&#39;NameFilm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">movie_name</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">found_movies</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                        <span class="s1">&#39;–§–∏–ª—å–º –Ω–µ –Ω–∞–π–¥–µ–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑:&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">register_next_step_handler</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">search_movie</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">movie</span> <span class="o">=</span> <span class="n">found_movies</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_movie_details</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">movie</span><span class="p">)</span></div>


<div class="viewcode-block" id="MovieBot.select_genre">
<a class="viewcode-back" href="../../telegram_bot.html#telegram_bot.main.MovieBot.select_genre">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
    <span class="k">def</span> <span class="nf">select_genre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—ã–±–æ—Ä –∂–∞–Ω—Ä–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º.</span>

<span class="sd">        :param message: –û–±—ä–µ–∫—Ç —Å–æ–æ–±—â–µ–Ω–∏—è —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º –∂–∞–Ω—Ä–æ–º</span>
<span class="sd">        :type message: telebot.types.Message</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">genre</span> <span class="o">=</span> <span class="n">message</span><span class="o">.</span><span class="n">text</span>
        <span class="k">if</span> <span class="n">genre</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="p">[</span><span class="s1">&#39;Genres&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="nb">eval</span><span class="p">)</span><span class="o">.</span><span class="n">explode</span><span class="p">()</span><span class="o">.</span><span class="n">unique</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                  <span class="s1">&#39;–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –∂–∞–Ω—Ä –∏–∑ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–Ω—ã—Ö.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_main_menu</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">top_movies_by_genre</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">genre</span><span class="p">)</span></div>


<div class="viewcode-block" id="MovieBot.top_movies_by_genre">
<a class="viewcode-back" href="../../telegram_bot.html#telegram_bot.main.MovieBot.top_movies_by_genre">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
    <span class="k">def</span> <span class="nf">top_movies_by_genre</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">genre</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ø 10 —Ñ–∏–ª—å–º–æ–≤ –ø–æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º—É –∂–∞–Ω—Ä—É.</span>

<span class="sd">        :param message: –û–±—ä–µ–∫—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è</span>
<span class="sd">        :type message: telebot.types.Message</span>
<span class="sd">        :param genre: –í—ã–±—Ä–∞–Ω–Ω—ã–π –∂–∞–Ω—Ä</span>
<span class="sd">        :type genre: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">genre_movies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="p">[</span><span class="s1">&#39;Genres&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">genre</span> <span class="ow">in</span> <span class="nb">eval</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
            <span class="p">]</span>
            <span class="n">top_movies</span> <span class="o">=</span> <span class="n">genre_movies</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;ratingKP&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">top_movies</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                      <span class="sa">f</span><span class="s1">&#39;–§–∏–ª—å–º—ã –∂–∞–Ω—Ä–∞ &quot;</span><span class="si">{</span><span class="n">genre</span><span class="si">}</span><span class="s1">&quot; –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_top_movies</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">top_movies</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;–∂–∞–Ω—Ä—É &quot;</span><span class="si">{</span><span class="n">genre</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">show_main_menu</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                  <span class="sa">f</span><span class="s1">&#39;–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –ø–æ –∂–∞–Ω—Ä—É: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_main_menu</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="MovieBot.top_movies_by_year">
<a class="viewcode-back" href="../../telegram_bot.html#telegram_bot.main.MovieBot.top_movies_by_year">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
    <span class="k">def</span> <span class="nf">top_movies_by_year</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ø 10 —Ñ–∏–ª—å–º–æ–≤ –∑–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –≥–æ–¥.</span>

<span class="sd">        :param message: –û–±—ä–µ–∫—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è</span>
<span class="sd">        :type message: telebot.types.Message</span>
<span class="sd">        :param year: –ì–æ–¥ –≤—ã–ø—É—Å–∫–∞ —Ñ–∏–ª—å–º–æ–≤</span>
<span class="sd">        :type year: int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">current_year</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">year</span>
            <span class="k">if</span> <span class="n">year</span> <span class="o">&lt;</span> <span class="mi">1900</span> <span class="ow">or</span> <span class="n">year</span> <span class="o">&gt;</span> <span class="n">current_year</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                      <span class="sa">f</span><span class="s1">&#39;–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≥–æ–¥ –º–µ–∂–¥—É 1900 –∏ </span><span class="si">{</span><span class="n">current_year</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_main_menu</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
                <span class="k">return</span>

            <span class="n">year_movies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">year</span><span class="p">]</span>
            <span class="n">top_movies</span> <span class="o">=</span> <span class="n">year_movies</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;ratingKP&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">top_movies</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                      <span class="sa">f</span><span class="s1">&#39;–§–∏–ª—å–º—ã –∑–∞ </span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1"> –≥–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_top_movies</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">top_movies</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">year</span><span class="si">}</span><span class="s1"> –≥–æ–¥—É&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">show_main_menu</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                  <span class="sa">f</span><span class="s1">&#39;–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –ø–æ –≥–æ–¥—É: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_main_menu</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="MovieBot.top_movies_by_director">
<a class="viewcode-back" href="../../telegram_bot.html#telegram_bot.main.MovieBot.top_movies_by_director">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
    <span class="k">def</span> <span class="nf">top_movies_by_director</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">director</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ø 10 —Ñ–∏–ª—å–º–æ–≤ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏—Å—Å–µ—Ä–∞.</span>

<span class="sd">        :param message: –û–±—ä–µ–∫—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è</span>
<span class="sd">        :type message: telebot.types.Message</span>
<span class="sd">        :param director: –ò–º—è —Ä–µ–∂–∏—Å—Å–µ—Ä–∞</span>
<span class="sd">        :type director: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">director_movies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="p">[</span><span class="s1">&#39;Directors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">director</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">top_movies</span> <span class="o">=</span> <span class="n">director_movies</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;ratingKP&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">top_movies</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                      <span class="sa">f</span><span class="s1">&#39;–§–∏–ª—å–º—ã —Ä–µ–∂–∏—Å—Å–µ—Ä–∞ </span><span class="si">{</span><span class="n">director</span><span class="si">}</span><span class="s1"> –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_top_movies</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">top_movies</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;—Ä–µ–∂–∏—Å—Å–µ—Ä—É </span><span class="si">{</span><span class="n">director</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">show_main_menu</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                  <span class="sa">f</span><span class="s1">&#39;–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –ø–æ —Ä–µ–∂–∏—Å—Å–µ—Ä—É: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_main_menu</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="MovieBot.top_movies_by_actor">
<a class="viewcode-back" href="../../telegram_bot.html#telegram_bot.main.MovieBot.top_movies_by_actor">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
    <span class="k">def</span> <span class="nf">top_movies_by_actor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">actor</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ–ø 10 —Ñ–∏–ª—å–º–æ–≤ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º –∞–∫—Ç–µ—Ä–æ–º.</span>

<span class="sd">        :param message: –û–±—ä–µ–∫—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è</span>
<span class="sd">        :type message: telebot.types.Message</span>
<span class="sd">        :param actor: –ò–º—è –∞–∫—Ç–µ—Ä–∞</span>
<span class="sd">        :type actor: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">actor_movies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="p">[</span><span class="s1">&#39;Actors&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">actor</span><span class="p">,</span> <span class="n">case</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">na</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">top_movies</span> <span class="o">=</span> <span class="n">actor_movies</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="s1">&#39;ratingKP&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">top_movies</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                      <span class="sa">f</span><span class="s1">&#39;–§–∏–ª—å–º—ã —Å –∞–∫—Ç–µ—Ä–æ–º </span><span class="si">{</span><span class="n">actor</span><span class="si">}</span><span class="s1"> –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">send_top_movies</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">top_movies</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;–∞–∫—Ç–µ—Ä—É </span><span class="si">{</span><span class="n">actor</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">show_main_menu</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                                  <span class="sa">f</span><span class="s1">&#39;–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–∏—Å–∫–µ –ø–æ –∞–∫—Ç–µ—Ä—É: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_main_menu</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="MovieBot.send_top_movies">
<a class="viewcode-back" href="../../telegram_bot.html#telegram_bot.main.MovieBot.send_top_movies">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
    <span class="k">def</span> <span class="nf">send_top_movies</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">top_movies</span><span class="p">,</span> <span class="n">category</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–ø–∏—Å–æ–∫ —Ç–æ–ø —Ñ–∏–ª—å–º–æ–≤ —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º–∏ –∫–Ω–æ–ø–∫–∞–º–∏.</span>

<span class="sd">        :param message: –û–±—ä–µ–∫—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è</span>
<span class="sd">        :type message: telebot.types.Message</span>
<span class="sd">        :param top_movies: DataFrame —Å —Ñ–∏–ª—å–º–∞–º–∏</span>
<span class="sd">        :type top_movies: pd.DataFrame</span>
<span class="sd">        :param category: –ö–∞—Ç–µ–≥–æ—Ä–∏—è –ø–æ–∏—Å–∫–∞ (–¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞)</span>
<span class="sd">        :type category: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è</span>
            <span class="n">movie_list</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;NameFilm&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">), ‚òÖ </span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;ratingKP&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">top_movies</span><span class="o">.</span><span class="n">iterrows</span><span class="p">())</span>
            <span class="p">])</span>

            <span class="c1"># –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å–æ —Å–ø–∏—Å–∫–æ–º</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span>
                <span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;üèÜ –¢–æ–ø —Ñ–∏–ª—å–º–æ–≤ –ø–æ </span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">:</span><span class="se">\n\n</span><span class="si">{</span><span class="n">movie_list</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">parse_mode</span><span class="o">=</span><span class="s1">&#39;Markdown&#39;</span>
            <span class="p">)</span>

            <span class="c1"># –°–æ–∑–¥–∞–µ–º –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏</span>
            <span class="n">markup</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">InlineKeyboardMarkup</span><span class="p">()</span>
            <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">top_movies</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="n">btn_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;NameFilm&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">)&quot;</span>
                <span class="n">markup</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">InlineKeyboardButton</span><span class="p">(</span>
                    <span class="n">btn_text</span><span class="p">,</span>
                    <span class="n">callback_data</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;movie_</span><span class="si">{</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;KPid&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">))</span>

            <span class="c1"># –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span>
                <span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s2">&quot;–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∏–ª—å–º –¥–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏:&quot;</span><span class="p">,</span>
                <span class="n">reply_markup</span><span class="o">=</span><span class="n">markup</span>
            <span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span>
                <span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">&#39;‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ —Å–ø–∏—Å–∫–∞ —Ñ–∏–ª—å–º–æ–≤.&#39;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_main_menu</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="MovieBot.show_movie_details">
<a class="viewcode-back" href="../../telegram_bot.html#telegram_bot.main.MovieBot.show_movie_details">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
    <span class="k">def</span> <span class="nf">show_movie_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">movie</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ñ–∏–ª—å–º–µ –∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏.</span>

<span class="sd">        :param message: –û–±—ä–µ–∫—Ç –≤—Ö–æ–¥—è—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</span>
<span class="sd">        :type message: telebot.types.Message</span>
<span class="sd">        :param movie: –î–∞–Ω–Ω—ã–µ –æ —Ñ–∏–ª—å–º–µ (—Å—Ç—Ä–æ–∫–∞ DataFrame)</span>
<span class="sd">        :type movie: pandas.Series</span>

<span class="sd">        :raises KeyError: –ï—Å–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –≤ –¥–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å–º–∞</span>
<span class="sd">        :raises Exception: –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π –∏–ª–∏ –º–µ–¥–∏–∞</span>

<span class="sd">        .. note::</span>
<span class="sd">            –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –≤ –¥–∞–Ω–Ω—ã—Ö —Ñ–∏–ª—å–º–∞:</span>
<span class="sd">            - NameFilm: –ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞</span>
<span class="sd">            - Year: –ì–æ–¥ –≤—ã–ø—É—Å–∫–∞</span>
<span class="sd">            - ratingKP: –†–µ–π—Ç–∏–Ω–≥ –ö–∏–Ω–æ–ø–æ–∏—Å–∫–∞</span>
<span class="sd">            - Description: –û–ø–∏—Å–∞–Ω–∏–µ —Ñ–∏–ª—å–º–∞</span>
<span class="sd">            - PosterUrl: URL –ø–æ—Å—Ç–µ—Ä–∞</span>
<span class="sd">            - WebUrl: URL –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞</span>
<span class="sd">            - WebUrl2: URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã –Ω–∞ –ö–∏–Ω–æ–ø–æ–∏—Å–∫–µ</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ</span>
            <span class="n">msg_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;üé¨ *</span><span class="si">{</span><span class="n">movie</span><span class="p">[</span><span class="s1">&#39;NameFilm&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">* (</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">movie</span><span class="p">[</span><span class="s1">&#39;Year&#39;</span><span class="p">])</span><span class="si">}</span><span class="s2">)</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="n">msg_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;üìù *–û–ø–∏—Å–∞–Ω–∏–µ:*</span><span class="se">\n</span><span class="si">{</span><span class="n">movie</span><span class="p">[</span><span class="s1">&#39;Description&#39;</span><span class="p">]</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="n">msg_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;üìä *–†–µ–π—Ç–∏–Ω–≥ –ö–ü:* </span><span class="si">{</span><span class="n">movie</span><span class="p">[</span><span class="s1">&#39;ratingKP&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="n">msg_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;‚≠ê *IMDb:* </span><span class="si">{</span><span class="n">movie</span><span class="p">[</span><span class="s1">&#39;ratingImdb&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">movie</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;filmLength&#39;</span><span class="p">)):</span>
                <span class="n">msg_text</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;‚è≥ *–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:* </span><span class="si">{</span><span class="n">movie</span><span class="p">[</span><span class="s1">&#39;filmLength&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> –º–∏–Ω.</span><span class="se">\n</span><span class="s2">&quot;</span>

            <span class="c1"># –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ–∫—Å—Ç–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">msg_text</span><span class="p">,</span> <span class="n">parse_mode</span><span class="o">=</span><span class="s1">&#39;Markdown&#39;</span><span class="p">)</span>

            <span class="c1"># –û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ—Å—Ç–µ—Ä–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">movie</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PosterUrl&#39;</span><span class="p">)):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_photo</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">movie</span><span class="p">[</span><span class="s1">&#39;PosterUrl&#39;</span><span class="p">])</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–æ—Å—Ç–µ—Ä–∞: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="s2">&quot;üñº –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ&quot;</span><span class="p">)</span>

            <span class="c1"># –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π</span>
            <span class="n">markup</span> <span class="o">=</span> <span class="n">types</span><span class="o">.</span><span class="n">InlineKeyboardMarkup</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">movie</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WebUrl&#39;</span><span class="p">)):</span>
                <span class="n">markup</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">InlineKeyboardButton</span><span class="p">(</span>
                    <span class="s1">&#39;üé• –°–º–æ—Ç—Ä–µ—Ç—å –æ–Ω–ª–∞–π–Ω&#39;</span><span class="p">,</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">movie</span><span class="p">[</span><span class="s1">&#39;WebUrl&#39;</span><span class="p">]</span>
                <span class="p">))</span>

            <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notna</span><span class="p">(</span><span class="n">movie</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;WebUrl2&#39;</span><span class="p">)):</span>
                <span class="n">markup</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">types</span><span class="o">.</span><span class="n">InlineKeyboardButton</span><span class="p">(</span>
                    <span class="s1">&#39;üìå –ö–∏–Ω–æ–ü–æ–∏—Å–∫&#39;</span><span class="p">,</span>
                    <span class="n">url</span><span class="o">=</span><span class="n">movie</span><span class="p">[</span><span class="s1">&#39;WebUrl2&#39;</span><span class="p">]</span>
                <span class="p">))</span>

            <span class="k">if</span> <span class="n">markup</span><span class="o">.</span><span class="n">keyboard</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span>
                    <span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                    <span class="s2">&quot;üîó –°—Å—ã–ª–∫–∏:&quot;</span><span class="p">,</span>
                    <span class="n">reply_markup</span><span class="o">=</span><span class="n">markup</span>
                <span class="p">)</span>

        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;‚ö†Ô∏è –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">error_msg</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] </span><span class="si">{</span><span class="n">error_msg</span><span class="si">}</span><span class="se">\n</span><span class="s2">–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–æ–ª—è: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="n">movie</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span>
                <span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s2">&quot;‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ñ–∏–ª—å–º–µ&quot;</span>
            <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[ERROR] show_movie_details: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_main_menu</span><span class="p">(</span><span class="n">message</span><span class="p">)</span></div>


<div class="viewcode-block" id="MovieBot.handle_movie_callback">
<a class="viewcode-back" href="../../telegram_bot.html#telegram_bot.main.MovieBot.handle_movie_callback">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
    <span class="k">def</span> <span class="nf">handle_movie_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">call</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç callback –æ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ –≤—ã–±–æ—Ä–∞ —Ñ–∏–ª—å–º–∞.</span>

<span class="sd">        :param call: –û–±—ä–µ–∫—Ç callback</span>
<span class="sd">        :type call: telebot.types.CallbackQuery</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">movie_id</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">call</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">movie</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">movies</span><span class="p">[</span><span class="s1">&#39;KPid&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">movie_id</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_movie_details</span><span class="p">(</span><span class="n">call</span><span class="o">.</span><span class="n">message</span><span class="p">,</span> <span class="n">movie</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span>
                <span class="n">call</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">&#39;‚ö†Ô∏è –§–∏–ª—å–º –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.&#39;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_main_menu</span><span class="p">(</span><span class="n">call</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">send_message</span><span class="p">(</span>
                <span class="n">call</span><span class="o">.</span><span class="n">message</span><span class="o">.</span><span class="n">chat</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="s1">&#39;‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∏–ª—å–º–∞.&#39;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_main_menu</span><span class="p">(</span><span class="n">call</span><span class="o">.</span><span class="n">message</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="run_bot">
<a class="viewcode-back" href="../../telegram_bot.html#telegram_bot.main.run_bot">[–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è]</a>
<span class="k">def</span> <span class="nf">run_bot</span><span class="p">(</span><span class="n">token</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    –ó–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º —Ç–æ–∫–µ–Ω–æ–º.</span>

<span class="sd">    :param token: API-—Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞</span>
<span class="sd">    :type token: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">keep_alive</span><span class="p">()</span>  <span class="c1"># –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º —Ñ–æ–Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å</span>
    <span class="n">movie_bot</span> <span class="o">=</span> <span class="n">MovieBot</span><span class="p">(</span><span class="n">token</span><span class="p">)</span>

    <span class="c1"># –ë–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">movie_bot</span><span class="o">.</span><span class="n">bot</span><span class="o">.</span><span class="n">polling</span><span class="p">(</span><span class="n">none_stop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;–û—à–∏–±–∫–∞: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="c1"># –¢–æ–∫–µ–Ω –±–æ—Ç–∞</span>
    <span class="n">BOT_TOKEN</span> <span class="o">=</span> <span class="s1">&#39;7606959553:AAGS4AwiHLHoafx_vuKOxB4mPW1SPSLSTKY&#39;</span>
    <span class="n">run_bot</span><span class="p">(</span><span class="n">BOT_TOKEN</span><span class="p">)</span>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">MovieBot</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="–ò—Å–∫–∞—Ç—å" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>–ù–∞–≤–∏–≥–∞—Ü–∏—è</h3>
<p class="caption" role="heading"><span class="caption-text">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">–í—Å–µ –º–æ–¥—É–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../parser.html">Parser Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Petrparser.html">Petrparser Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../telegram_bot.html">Telegram Bot Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../background.html">Background Service</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">–ö–æ–¥ –º–æ–¥—É–ª—è</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Novikov D.V., Polyakova V.V, Prepelitsa P.P..
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>